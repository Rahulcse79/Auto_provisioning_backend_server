let path,fs,rollup,rollupJson,typescript,terser,nodeResolve,commonjs,postcss,postcssImport,postcssPresetEnv,postcssColorMod,cssnano,optimize,xmlParser;_24f‍.w("path",[["*",null,function(v){path=v}]]);_24f‍.w("fs",[["*",null,function(v){fs=v}]]);_24f‍.w("rollup",[["rollup",["rollup"],function(v){rollup=v}]]);_24f‍.w("@rollup/plugin-json",[["default",["rollupJson"],function(v){rollupJson=v}]]);_24f‍.w("@rollup/plugin-typescript",[["default",["typescript"],function(v){typescript=v}]]);_24f‍.w("rollup-plugin-terser",[["terser",["terser"],function(v){terser=v}]]);_24f‍.w("@rollup/plugin-node-resolve",[["default",["nodeResolve"],function(v){nodeResolve=v}]]);_24f‍.w("@rollup/plugin-commonjs",[["default",["commonjs"],function(v){commonjs=v}]]);_24f‍.w("postcss",[["default",["postcss"],function(v){postcss=v}]]);_24f‍.w("postcss-import",[["default",["postcssImport"],function(v){postcssImport=v}]]);_24f‍.w("postcss-preset-env",[["default",["postcssPresetEnv"],function(v){postcssPresetEnv=v}]]);_24f‍.w("postcss-color-mod-function",[["default",["postcssColorMod"],function(v){postcssColorMod=v}]]);_24f‍.w("cssnano",[["default",["cssnano"],function(v){cssnano=v}]]);_24f‍.w("svgo",[["optimize",["optimize"],function(v){optimize=v}]]);_24f‍.w("../lib/xml-parser",[["*",null,function(v){xmlParser=v}]]);/**
 * Copyright 2013-2019  GenieACS Inc.
 *
 * This file is part of GenieACS.
 *
 * GenieACS is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * GenieACS is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with GenieACS.  If not, see <http://www.gnu.org/licenses/>.
 */















const MODE = process.env["NODE_ENV"] || "production";
const BUILD_METADATA = new Date()
    .toISOString()
    .split(".")[0]
    .replace(/[^0-9]/g, "");
const INPUT_DIR = path.resolve(__dirname, "..");
const OUTPUT_DIR = path.resolve(__dirname, "../dist");
const builtins = [
    "path",
    "fs",
    "cluster",
    "os",
    "tls",
    "http",
    "https",
    "zlib",
    "crypto",
    "util",
    "vm",
    "querystring",
    "child_process",
    "dgram",
    "url",
    "readline",
    "stream",
    "bson", // not a built-in but not a direct dependency either
];
function rmDirSync(dirPath) {
    if (!fs.existsSync(dirPath))
        return;
    const files = fs.readdirSync(dirPath);
    for (const file of files) {
        const filePath = `${dirPath}/${file}`;
        if (fs.statSync(filePath).isFile())
            fs.unlinkSync(filePath);
        else
            rmDirSync(filePath);
    }
    fs.rmdirSync(dirPath);
}
// For lockfileVersion = 1
function stripDevDeps(deps) {
    if (!deps["dependencies"])
        return;
    for (const [k, v] of Object.entries(deps["dependencies"])) {
        if (v["dev"])
            delete deps["dependencies"][k];
        else
            stripDevDeps(v);
    }
    if (!Object.keys(deps["dependencies"]).length)
        delete deps["dependencies"];
}
// For lockfileVersion = 2
function stripDevDeps2(deps) {
    if (!deps["packages"])
        return;
    for (const [k, v] of Object.entries(deps["packages"])) {
        delete v["devDependencies"];
        if (v["dev"])
            delete deps["packages"][k];
    }
}
function xmlTostring(xml) {
    const children = [];
    for (const c of xml.children || [])
        children.push(xmlTostring(c));
    return xml.name === "root" && xml.bodyIndex === 0
        ? children.join("")
        : `<${xml.name} ${xml.attrs}>${children.join("")}</${xml.name}>`;
}
function generateSymbol(id, svgStr) {
    const xml = xmlParser.parseXml(svgStr);
    const svg = xml.children[0];
    const svgAttrs = xmlParser.parseAttrs(svg.attrs);
    let viewBox = "";
    for (const a of svgAttrs) {
        if (a.name === "viewBox") {
            viewBox = `viewBox="${a.value}"`;
            break;
        }
    }
    const symbolBody = xml.children[0].children
        .map((c) => xmlTostring(c))
        .join("");
    return `<symbol id="icon-${id}" ${viewBox}>${symbolBody}</symbol>`;
}
async function init() {
    // Delete any old output directory
    rmDirSync(OUTPUT_DIR);
    // Create output directory layout
    fs.mkdirSync(OUTPUT_DIR);
    fs.mkdirSync(OUTPUT_DIR + "/bin");
    fs.mkdirSync(OUTPUT_DIR + "/public");
    // Create package.json
    const packageJson = JSON.parse(fs.readFileSync(path.resolve(INPUT_DIR, "package.json")).toString());
    delete packageJson["devDependencies"];
    delete packageJson["private"];
    packageJson["scripts"] = {
        install: packageJson["scripts"].install,
        configure: packageJson["scripts"].configure,
    };
    packageJson["version"] = `${packageJson["version"]}+${BUILD_METADATA}`;
    fs.writeFileSync(path.resolve(OUTPUT_DIR, "package.json"), JSON.stringify(packageJson, null, 2));
    // Create npm-shrinkwrap.json
    const npmShrinkwrapJson = JSON.parse(fs.readFileSync(path.resolve(INPUT_DIR, "npm-shrinkwrap.json")).toString());
    npmShrinkwrapJson["version"] = packageJson["version"];
    stripDevDeps(npmShrinkwrapJson);
    stripDevDeps2(npmShrinkwrapJson);
    fs.writeFileSync(path.resolve(OUTPUT_DIR, "npm-shrinkwrap.json"), JSON.stringify(npmShrinkwrapJson, null, 2));
    return Object.keys(packageJson["dependencies"]);
}
async function copyStatic() {
    const files = [
        "LICENSE",
        "README.md",
        "CHANGELOG.md",
        "public/logo.png",
        "public/favicon.png",
        "public/log-out.svg",
        "public/logoLight.png",
        "public/admin-users-svgrepo-com.svg",
        "public/devices-svgrepo-com.svg",
        "public/overview-svgrepo-com.svg",
        "public/shield-error-svgrepo-com.svg",
    ];
    for (const file of files) {
        fs.copyFileSync(path.resolve(INPUT_DIR, file), path.resolve(OUTPUT_DIR, file));
    }
}
async function generateCss() {
    const cssInPath = path.resolve(INPUT_DIR, "ui/css/app.css");
    const cssOutPath = path.resolve(OUTPUT_DIR, "public/app.css");
    const cssIn = fs.readFileSync(cssInPath);
    const cssOut = await postcss([
        postcssImport,
        postcssPresetEnv({
            stage: 3,
            features: {
                "nesting-rules": true,
            },
        }),
        postcssColorMod,
        ...(MODE === "production" ? [cssnano] : []),
    ]).process(cssIn, { from: cssInPath, to: cssOutPath });
    fs.writeFileSync(cssOutPath, cssOut.css);
}
async function generateBackendJs(externals) {
    for (const bin of [
        "genieacs-cwmp",
        "genieacs-ext",
        "genieacs-nbi",
        "genieacs-fs",
        "genieacs-ui",
    ]) {
        const inputFile = path.resolve(INPUT_DIR, `bin/${bin}.ts`);
        const outputFile = path.resolve(OUTPUT_DIR, `bin/${bin}`);
        const bundle = await rollup({
            input: inputFile,
            external: [...builtins, ...externals],
            acorn: {
                allowHashBang: true,
            },
            treeshake: {
                propertyReadSideEffects: false,
                moduleSideEffects: false,
            },
            plugins: [
                rollupJson({ preferConst: true }),
                {
                    name: "",
                    resolveId: (importee, importer) => {
                        if (importee.endsWith("/package.json")) {
                            const p = path.resolve(path.dirname(importer), importee);
                            if (p === path.resolve(INPUT_DIR, "package.json"))
                                return path.resolve(OUTPUT_DIR, "package.json");
                        }
                        return null;
                    },
                },
                typescript({
                    tsconfig: "./tsconfig.json",
                    include: [`bin/${bin}.ts`, "lib/**/*.ts"],
                }),
                MODE === "production" ? terser() : null,
            ],
        });
        await bundle.write({
            format: "cjs",
            preferConst: true,
            sourcemap: "inline",
            sourcemapExcludeSources: true,
            banner: "#!/usr/bin/env node",
            file: outputFile,
        });
        // Mark as executable
        const mode = fs.statSync(outputFile).mode;
        fs.chmodSync(outputFile, mode | 73);
    }
}
async function generateFrontendJs(externals) {
    const inputFile = path.resolve(INPUT_DIR, "ui/app.ts");
    const outputDir = path.resolve(OUTPUT_DIR, "public");
    const inlineDeps = ["parsimmon", "espresso-iisojs"];
    const bundle = await rollup({
        input: inputFile,
        external: [
            ...builtins,
            ...externals.filter((e) => !inlineDeps.includes(e)),
        ],
        plugins: [
            rollupJson({ preferConst: true }),
            {
                name: "",
                resolveId: function (importee, importer) {
                    if (importee.endsWith("/package.json")) {
                        const p = path.resolve(path.dirname(importer), importee);
                        if (p === path.resolve(INPUT_DIR, "package.json"))
                            return path.resolve(OUTPUT_DIR, "package.json");
                    }
                    return null;
                },
            },
            typescript({ tsconfig: "./tsconfig.json" }),
            nodeResolve(),
            commonjs(),
            MODE === "production" ? terser() : null,
        ],
        preserveEntrySignatures: false,
        treeshake: {
            propertyReadSideEffects: false,
            moduleSideEffects: false,
        },
        onwarn: ((warning, warn) => {
            // Ignore circular dependency warnings
            if (warning.code !== "CIRCULAR_DEPENDENCY")
                warn(warning);
        }),
    });
    await bundle.write({
        manualChunks: (id) => {
            if (id.includes("node_modules/codemirror"))
                return "codemirror";
            else if (id.includes("node_modules/yaml"))
                return "yaml";
            return "app";
        },
        preferConst: true,
        format: "es",
        sourcemap: true,
        sourcemapExcludeSources: true,
        dir: outputDir,
    });
}
async function generateIconsSprite() {
    const symbols = [];
    const iconsDir = path.resolve(INPUT_DIR, "ui/icons");
    for (const file of fs.readdirSync(iconsDir)) {
        const id = path.parse(file).name;
        const filePath = path.join(iconsDir, file);
        const { data } = await optimize(fs.readFileSync(filePath).toString(), {
            plugins: [
                {
                    name: "preset-default",
                    params: {
                        overrides: {
                            removeViewBox: false,
                        },
                    },
                },
            ],
        });
        symbols.push(generateSymbol(id, data));
    }
    fs.writeFileSync(path.resolve(OUTPUT_DIR, "public/icons.svg"), `<svg xmlns="http://www.w3.org/2000/svg">${symbols.join("")}</svg>`);
}
init()
    .then((externals) => {
    Promise.all([
        copyStatic(),
        generateCss(),
        generateIconsSprite(),
        generateBackendJs(externals),
        generateFrontendJs(externals),
    ])
        .then(() => {
        // Ignore
    })
        .catch((err) => {
        process.stderr.write(err.stack + "\n");
    });
})
    .catch((err) => {
    process.stderr.write(err.stack + "\n");
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvY29yYWwvRG9jdW1lbnRzL0dpdEh1Yi9hY3Mtc2VydmVyL2J1aWxkL2J1aWxkLnRzIiwic291cmNlcyI6WyIvaG9tZS9jb3JhbC9Eb2N1bWVudHMvR2l0SHViL2Fjcy1zZXJ2ZXIvYnVpbGQvYnVpbGQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaUJHO0FBRUgsT0FBTyxLQUFLLElBQUksTUFBTSxNQUFNLENBQUM7QUFDN0IsT0FBTyxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFDekIsT0FBTyxFQUFFLE1BQU0sRUFBa0IsTUFBTSxRQUFRLENBQUM7QUFDaEQsT0FBTyxVQUFVLE1BQU0scUJBQXFCLENBQUM7QUFDN0MsT0FBTyxVQUFVLE1BQU0sMkJBQTJCLENBQUM7QUFDbkQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzlDLE9BQU8sV0FBVyxNQUFNLDZCQUE2QixDQUFDO0FBQ3RELE9BQU8sUUFBUSxNQUFNLHlCQUF5QixDQUFDO0FBQy9DLE9BQU8sT0FBTyxNQUFNLFNBQVMsQ0FBQztBQUM5QixPQUFPLGFBQWEsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLGdCQUFnQixNQUFNLG9CQUFvQixDQUFDO0FBQ2xELE9BQU8sZUFBZSxNQUFNLDRCQUE0QixDQUFDO0FBQ3pELE9BQU8sT0FBTyxNQUFNLFNBQVMsQ0FBQztBQUM5QixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2hDLE9BQU8sS0FBSyxTQUFTLE1BQU0sbUJBQW1CLENBQUM7QUFFL0MsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxZQUFZLENBQUM7QUFFckQsTUFBTSxjQUFjLEdBQUcsSUFBSSxJQUFJLEVBQUU7S0FDOUIsV0FBVyxFQUFFO0tBQ2IsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNiLE9BQU8sQ0FBQyxT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R0FBRyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQztBQUN6QyxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IDIwMTMtMjAxOSAgR2VuaWVBQ1MgSW5jLlxuICpcbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIEdlbmllQUNTLlxuICpcbiAqIEdlbmllQUNTIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzXG4gKiBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGVcbiAqIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogR2VuaWVBQ1MgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggR2VuaWVBQ1MuICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgeyByb2xsdXAsIFdhcm5pbmdIYW5kbGVyIH0gZnJvbSBcInJvbGx1cFwiO1xuaW1wb3J0IHJvbGx1cEpzb24gZnJvbSBcIkByb2xsdXAvcGx1Z2luLWpzb25cIjtcbmltcG9ydCB0eXBlc2NyaXB0IGZyb20gXCJAcm9sbHVwL3BsdWdpbi10eXBlc2NyaXB0XCI7XG5pbXBvcnQgeyB0ZXJzZXIgfSBmcm9tIFwicm9sbHVwLXBsdWdpbi10ZXJzZXJcIjtcbmltcG9ydCBub2RlUmVzb2x2ZSBmcm9tIFwiQHJvbGx1cC9wbHVnaW4tbm9kZS1yZXNvbHZlXCI7XG5pbXBvcnQgY29tbW9uanMgZnJvbSBcIkByb2xsdXAvcGx1Z2luLWNvbW1vbmpzXCI7XG5pbXBvcnQgcG9zdGNzcyBmcm9tIFwicG9zdGNzc1wiO1xuaW1wb3J0IHBvc3Rjc3NJbXBvcnQgZnJvbSBcInBvc3Rjc3MtaW1wb3J0XCI7XG5pbXBvcnQgcG9zdGNzc1ByZXNldEVudiBmcm9tIFwicG9zdGNzcy1wcmVzZXQtZW52XCI7XG5pbXBvcnQgcG9zdGNzc0NvbG9yTW9kIGZyb20gXCJwb3N0Y3NzLWNvbG9yLW1vZC1mdW5jdGlvblwiO1xuaW1wb3J0IGNzc25hbm8gZnJvbSBcImNzc25hbm9cIjtcbmltcG9ydCB7IG9wdGltaXplIH0gZnJvbSBcInN2Z29cIjtcbmltcG9ydCAqIGFzIHhtbFBhcnNlciBmcm9tIFwiLi4vbGliL3htbC1wYXJzZXJcIjtcblxuY29uc3QgTU9ERSA9IHByb2Nlc3MuZW52W1wiTk9ERV9FTlZcIl0gfHwgXCJwcm9kdWN0aW9uXCI7XG5cbmNvbnN0IEJVSUxEX01FVEFEQVRBID0gbmV3IERhdGUoKVxuICAudG9JU09TdHJpbmcoKVxuICAuc3BsaXQoXCIuXCIpWzBdXG4gIC5yZXBsYWNlKC9bXjAtOV0vZywgXCJcIik7XG5cbmNvbnN0IElOUFVUX0RJUiA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi5cIik7XG5jb25zdCBPVVRQVVRfRElSID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgXCIuLi9kaXN0XCIpO1xuXG5jb25zdCBidWlsdGlucyA9IFtcbiAgXCJwYXRoXCIsXG4gIFwiZnNcIixcbiAgXCJjbHVzdGVyXCIsXG4gIFwib3NcIixcbiAgXCJ0bHNcIixcbiAgXCJodHRwXCIsXG4gIFwiaHR0cHNcIixcbiAgXCJ6bGliXCIsXG4gIFwiY3J5cHRvXCIsXG4gIFwidXRpbFwiLFxuICBcInZtXCIsXG4gIFwicXVlcnlzdHJpbmdcIixcbiAgXCJjaGlsZF9wcm9jZXNzXCIsXG4gIFwiZGdyYW1cIixcbiAgXCJ1cmxcIixcbiAgXCJyZWFkbGluZVwiLFxuICBcInN0cmVhbVwiLFxuICBcImJzb25cIiwgLy8gbm90IGEgYnVpbHQtaW4gYnV0IG5vdCBhIGRpcmVjdCBkZXBlbmRlbmN5IGVpdGhlclxuXTtcblxuZnVuY3Rpb24gcm1EaXJTeW5jKGRpclBhdGgpOiB2b2lkIHtcbiAgaWYgKCFmcy5leGlzdHNTeW5jKGRpclBhdGgpKSByZXR1cm47XG4gIGNvbnN0IGZpbGVzID0gZnMucmVhZGRpclN5bmMoZGlyUGF0aCk7XG5cbiAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgY29uc3QgZmlsZVBhdGggPSBgJHtkaXJQYXRofS8ke2ZpbGV9YDtcbiAgICBpZiAoZnMuc3RhdFN5bmMoZmlsZVBhdGgpLmlzRmlsZSgpKSBmcy51bmxpbmtTeW5jKGZpbGVQYXRoKTtcbiAgICBlbHNlIHJtRGlyU3luYyhmaWxlUGF0aCk7XG4gIH1cbiAgZnMucm1kaXJTeW5jKGRpclBhdGgpO1xufVxuXG4vLyBGb3IgbG9ja2ZpbGVWZXJzaW9uID0gMVxuZnVuY3Rpb24gc3RyaXBEZXZEZXBzKGRlcHMpOiB2b2lkIHtcbiAgaWYgKCFkZXBzW1wiZGVwZW5kZW5jaWVzXCJdKSByZXR1cm47XG4gIGZvciAoY29uc3QgW2ssIHZdIG9mIE9iamVjdC5lbnRyaWVzKGRlcHNbXCJkZXBlbmRlbmNpZXNcIl0pKSB7XG4gICAgaWYgKHZbXCJkZXZcIl0pIGRlbGV0ZSBkZXBzW1wiZGVwZW5kZW5jaWVzXCJdW2tdO1xuICAgIGVsc2Ugc3RyaXBEZXZEZXBzKHYpO1xuICB9XG4gIGlmICghT2JqZWN0LmtleXMoZGVwc1tcImRlcGVuZGVuY2llc1wiXSkubGVuZ3RoKSBkZWxldGUgZGVwc1tcImRlcGVuZGVuY2llc1wiXTtcbn1cblxuLy8gRm9yIGxvY2tmaWxlVmVyc2lvbiA9IDJcbmZ1bmN0aW9uIHN0cmlwRGV2RGVwczIoZGVwcyk6IHZvaWQge1xuICBpZiAoIWRlcHNbXCJwYWNrYWdlc1wiXSkgcmV0dXJuO1xuICBmb3IgKGNvbnN0IFtrLCB2XSBvZiBPYmplY3QuZW50cmllcyhkZXBzW1wicGFja2FnZXNcIl0pKSB7XG4gICAgZGVsZXRlIHZbXCJkZXZEZXBlbmRlbmNpZXNcIl07XG4gICAgaWYgKHZbXCJkZXZcIl0pIGRlbGV0ZSBkZXBzW1wicGFja2FnZXNcIl1ba107XG4gIH1cbn1cblxuZnVuY3Rpb24geG1sVG9zdHJpbmcoeG1sKTogc3RyaW5nIHtcbiAgY29uc3QgY2hpbGRyZW4gPSBbXTtcbiAgZm9yIChjb25zdCBjIG9mIHhtbC5jaGlsZHJlbiB8fCBbXSkgY2hpbGRyZW4ucHVzaCh4bWxUb3N0cmluZyhjKSk7XG5cbiAgcmV0dXJuIHhtbC5uYW1lID09PSBcInJvb3RcIiAmJiB4bWwuYm9keUluZGV4ID09PSAwXG4gICAgPyBjaGlsZHJlbi5qb2luKFwiXCIpXG4gICAgOiBgPCR7eG1sLm5hbWV9ICR7eG1sLmF0dHJzfT4ke2NoaWxkcmVuLmpvaW4oXCJcIil9PC8ke3htbC5uYW1lfT5gO1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZVN5bWJvbChpZDogc3RyaW5nLCBzdmdTdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IHhtbCA9IHhtbFBhcnNlci5wYXJzZVhtbChzdmdTdHIpO1xuICBjb25zdCBzdmcgPSB4bWwuY2hpbGRyZW5bMF07XG4gIGNvbnN0IHN2Z0F0dHJzID0geG1sUGFyc2VyLnBhcnNlQXR0cnMoc3ZnLmF0dHJzKTtcbiAgbGV0IHZpZXdCb3ggPSBcIlwiO1xuICBmb3IgKGNvbnN0IGEgb2Ygc3ZnQXR0cnMpIHtcbiAgICBpZiAoYS5uYW1lID09PSBcInZpZXdCb3hcIikge1xuICAgICAgdmlld0JveCA9IGB2aWV3Qm94PVwiJHthLnZhbHVlfVwiYDtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBjb25zdCBzeW1ib2xCb2R5ID0geG1sLmNoaWxkcmVuWzBdLmNoaWxkcmVuXG4gICAgLm1hcCgoYykgPT4geG1sVG9zdHJpbmcoYykpXG4gICAgLmpvaW4oXCJcIik7XG4gIHJldHVybiBgPHN5bWJvbCBpZD1cImljb24tJHtpZH1cIiAke3ZpZXdCb3h9PiR7c3ltYm9sQm9keX08L3N5bWJvbD5gO1xufVxuXG5hc3luYyBmdW5jdGlvbiBpbml0KCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgLy8gRGVsZXRlIGFueSBvbGQgb3V0cHV0IGRpcmVjdG9yeVxuICBybURpclN5bmMoT1VUUFVUX0RJUik7XG5cbiAgLy8gQ3JlYXRlIG91dHB1dCBkaXJlY3RvcnkgbGF5b3V0XG4gIGZzLm1rZGlyU3luYyhPVVRQVVRfRElSKTtcbiAgZnMubWtkaXJTeW5jKE9VVFBVVF9ESVIgKyBcIi9iaW5cIik7XG4gIGZzLm1rZGlyU3luYyhPVVRQVVRfRElSICsgXCIvcHVibGljXCIpO1xuXG4gIC8vIENyZWF0ZSBwYWNrYWdlLmpzb25cbiAgY29uc3QgcGFja2FnZUpzb24gPSBKU09OLnBhcnNlKFxuICAgIGZzLnJlYWRGaWxlU3luYyhwYXRoLnJlc29sdmUoSU5QVVRfRElSLCBcInBhY2thZ2UuanNvblwiKSkudG9TdHJpbmcoKVxuICApO1xuICBkZWxldGUgcGFja2FnZUpzb25bXCJkZXZEZXBlbmRlbmNpZXNcIl07XG4gIGRlbGV0ZSBwYWNrYWdlSnNvbltcInByaXZhdGVcIl07XG4gIHBhY2thZ2VKc29uW1wic2NyaXB0c1wiXSA9IHtcbiAgICBpbnN0YWxsOiBwYWNrYWdlSnNvbltcInNjcmlwdHNcIl0uaW5zdGFsbCxcbiAgICBjb25maWd1cmU6IHBhY2thZ2VKc29uW1wic2NyaXB0c1wiXS5jb25maWd1cmUsXG4gIH07XG4gIHBhY2thZ2VKc29uW1widmVyc2lvblwiXSA9IGAke3BhY2thZ2VKc29uW1widmVyc2lvblwiXX0rJHtCVUlMRF9NRVRBREFUQX1gO1xuICBmcy53cml0ZUZpbGVTeW5jKFxuICAgIHBhdGgucmVzb2x2ZShPVVRQVVRfRElSLCBcInBhY2thZ2UuanNvblwiKSxcbiAgICBKU09OLnN0cmluZ2lmeShwYWNrYWdlSnNvbiwgbnVsbCwgMilcbiAgKTtcblxuICAvLyBDcmVhdGUgbnBtLXNocmlua3dyYXAuanNvblxuICBjb25zdCBucG1TaHJpbmt3cmFwSnNvbiA9IEpTT04ucGFyc2UoXG4gICAgZnMucmVhZEZpbGVTeW5jKHBhdGgucmVzb2x2ZShJTlBVVF9ESVIsIFwibnBtLXNocmlua3dyYXAuanNvblwiKSkudG9TdHJpbmcoKVxuICApO1xuICBucG1TaHJpbmt3cmFwSnNvbltcInZlcnNpb25cIl0gPSBwYWNrYWdlSnNvbltcInZlcnNpb25cIl07XG4gIHN0cmlwRGV2RGVwcyhucG1TaHJpbmt3cmFwSnNvbik7XG4gIHN0cmlwRGV2RGVwczIobnBtU2hyaW5rd3JhcEpzb24pO1xuICBmcy53cml0ZUZpbGVTeW5jKFxuICAgIHBhdGgucmVzb2x2ZShPVVRQVVRfRElSLCBcIm5wbS1zaHJpbmt3cmFwLmpzb25cIiksXG4gICAgSlNPTi5zdHJpbmdpZnkobnBtU2hyaW5rd3JhcEpzb24sIG51bGwsIDIpXG4gICk7XG4gIHJldHVybiBPYmplY3Qua2V5cyhwYWNrYWdlSnNvbltcImRlcGVuZGVuY2llc1wiXSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNvcHlTdGF0aWMoKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IGZpbGVzID0gW1xuICAgIFwiTElDRU5TRVwiLFxuICAgIFwiUkVBRE1FLm1kXCIsXG4gICAgXCJDSEFOR0VMT0cubWRcIixcbiAgICBcInB1YmxpYy9sb2dvLnBuZ1wiLFxuICAgIFwicHVibGljL2Zhdmljb24ucG5nXCIsXG4gICAgXCJwdWJsaWMvbG9nLW91dC5zdmdcIixcbiAgICBcInB1YmxpYy9sb2dvTGlnaHQucG5nXCIsXG4gICAgXCJwdWJsaWMvYWRtaW4tdXNlcnMtc3ZncmVwby1jb20uc3ZnXCIsXG4gICAgXCJwdWJsaWMvZGV2aWNlcy1zdmdyZXBvLWNvbS5zdmdcIixcbiAgICBcInB1YmxpYy9vdmVydmlldy1zdmdyZXBvLWNvbS5zdmdcIixcbiAgICBcInB1YmxpYy9zaGllbGQtZXJyb3Itc3ZncmVwby1jb20uc3ZnXCIsXG4gIF07XG5cbiAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgZnMuY29weUZpbGVTeW5jKFxuICAgICAgcGF0aC5yZXNvbHZlKElOUFVUX0RJUiwgZmlsZSksXG4gICAgICBwYXRoLnJlc29sdmUoT1VUUFVUX0RJUiwgZmlsZSlcbiAgICApO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlQ3NzKCk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBjc3NJblBhdGggPSBwYXRoLnJlc29sdmUoSU5QVVRfRElSLCBcInVpL2Nzcy9hcHAuY3NzXCIpO1xuICBjb25zdCBjc3NPdXRQYXRoID0gcGF0aC5yZXNvbHZlKE9VVFBVVF9ESVIsIFwicHVibGljL2FwcC5jc3NcIik7XG4gIGNvbnN0IGNzc0luID0gZnMucmVhZEZpbGVTeW5jKGNzc0luUGF0aCk7XG4gIGNvbnN0IGNzc091dCA9IGF3YWl0IHBvc3Rjc3MoW1xuICAgIHBvc3Rjc3NJbXBvcnQsXG4gICAgcG9zdGNzc1ByZXNldEVudih7XG4gICAgICBzdGFnZTogMyxcbiAgICAgIGZlYXR1cmVzOiB7XG4gICAgICAgIFwibmVzdGluZy1ydWxlc1wiOiB0cnVlLFxuICAgICAgfSxcbiAgICB9KSxcbiAgICBwb3N0Y3NzQ29sb3JNb2QsXG4gICAgLi4uKE1PREUgPT09IFwicHJvZHVjdGlvblwiID8gW2Nzc25hbm9dIDogW10pLFxuICBdKS5wcm9jZXNzKGNzc0luLCB7IGZyb206IGNzc0luUGF0aCwgdG86IGNzc091dFBhdGggfSk7XG4gIGZzLndyaXRlRmlsZVN5bmMoY3NzT3V0UGF0aCwgY3NzT3V0LmNzcyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlQmFja2VuZEpzKGV4dGVybmFsczogc3RyaW5nW10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgZm9yIChjb25zdCBiaW4gb2YgW1xuICAgIFwiZ2VuaWVhY3MtY3dtcFwiLFxuICAgIFwiZ2VuaWVhY3MtZXh0XCIsXG4gICAgXCJnZW5pZWFjcy1uYmlcIixcbiAgICBcImdlbmllYWNzLWZzXCIsXG4gICAgXCJnZW5pZWFjcy11aVwiLFxuICBdKSB7XG4gICAgY29uc3QgaW5wdXRGaWxlID0gcGF0aC5yZXNvbHZlKElOUFVUX0RJUiwgYGJpbi8ke2Jpbn0udHNgKTtcbiAgICBjb25zdCBvdXRwdXRGaWxlID0gcGF0aC5yZXNvbHZlKE9VVFBVVF9ESVIsIGBiaW4vJHtiaW59YCk7XG4gICAgY29uc3QgYnVuZGxlID0gYXdhaXQgcm9sbHVwKHtcbiAgICAgIGlucHV0OiBpbnB1dEZpbGUsXG4gICAgICBleHRlcm5hbDogWy4uLmJ1aWx0aW5zLCAuLi5leHRlcm5hbHNdLFxuICAgICAgYWNvcm46IHtcbiAgICAgICAgYWxsb3dIYXNoQmFuZzogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICB0cmVlc2hha2U6IHtcbiAgICAgICAgcHJvcGVydHlSZWFkU2lkZUVmZmVjdHM6IGZhbHNlLFxuICAgICAgICBtb2R1bGVTaWRlRWZmZWN0czogZmFsc2UsXG4gICAgICB9LFxuICAgICAgcGx1Z2luczogW1xuICAgICAgICByb2xsdXBKc29uKHsgcHJlZmVyQ29uc3Q6IHRydWUgfSksXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiBcIlwiLFxuICAgICAgICAgIHJlc29sdmVJZDogKGltcG9ydGVlLCBpbXBvcnRlcikgPT4ge1xuICAgICAgICAgICAgaWYgKGltcG9ydGVlLmVuZHNXaXRoKFwiL3BhY2thZ2UuanNvblwiKSkge1xuICAgICAgICAgICAgICBjb25zdCBwID0gcGF0aC5yZXNvbHZlKHBhdGguZGlybmFtZShpbXBvcnRlciksIGltcG9ydGVlKTtcbiAgICAgICAgICAgICAgaWYgKHAgPT09IHBhdGgucmVzb2x2ZShJTlBVVF9ESVIsIFwicGFja2FnZS5qc29uXCIpKVxuICAgICAgICAgICAgICAgIHJldHVybiBwYXRoLnJlc29sdmUoT1VUUFVUX0RJUiwgXCJwYWNrYWdlLmpzb25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB0eXBlc2NyaXB0KHtcbiAgICAgICAgICB0c2NvbmZpZzogXCIuL3RzY29uZmlnLmpzb25cIixcbiAgICAgICAgICBpbmNsdWRlOiBbYGJpbi8ke2Jpbn0udHNgLCBcImxpYi8qKi8qLnRzXCJdLFxuICAgICAgICB9KSxcbiAgICAgICAgTU9ERSA9PT0gXCJwcm9kdWN0aW9uXCIgPyB0ZXJzZXIoKSA6IG51bGwsXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgYXdhaXQgYnVuZGxlLndyaXRlKHtcbiAgICAgIGZvcm1hdDogXCJjanNcIixcbiAgICAgIHByZWZlckNvbnN0OiB0cnVlLFxuICAgICAgc291cmNlbWFwOiBcImlubGluZVwiLFxuICAgICAgc291cmNlbWFwRXhjbHVkZVNvdXJjZXM6IHRydWUsXG4gICAgICBiYW5uZXI6IFwiIyEvdXNyL2Jpbi9lbnYgbm9kZVwiLFxuICAgICAgZmlsZTogb3V0cHV0RmlsZSxcbiAgICB9KTtcblxuICAgIC8vIE1hcmsgYXMgZXhlY3V0YWJsZVxuICAgIGNvbnN0IG1vZGUgPSBmcy5zdGF0U3luYyhvdXRwdXRGaWxlKS5tb2RlO1xuICAgIGZzLmNobW9kU3luYyhvdXRwdXRGaWxlLCBtb2RlIHwgNzMpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlRnJvbnRlbmRKcyhleHRlcm5hbHM6IHN0cmluZ1tdKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IGlucHV0RmlsZSA9IHBhdGgucmVzb2x2ZShJTlBVVF9ESVIsIFwidWkvYXBwLnRzXCIpO1xuICBjb25zdCBvdXRwdXREaXIgPSBwYXRoLnJlc29sdmUoT1VUUFVUX0RJUiwgXCJwdWJsaWNcIik7XG5cbiAgY29uc3QgaW5saW5lRGVwcyA9IFtcInBhcnNpbW1vblwiLCBcImVzcHJlc3NvLWlpc29qc1wiXTtcbiAgY29uc3QgYnVuZGxlID0gYXdhaXQgcm9sbHVwKHtcbiAgICBpbnB1dDogaW5wdXRGaWxlLFxuICAgIGV4dGVybmFsOiBbXG4gICAgICAuLi5idWlsdGlucyxcbiAgICAgIC4uLmV4dGVybmFscy5maWx0ZXIoKGUpID0+ICFpbmxpbmVEZXBzLmluY2x1ZGVzKGUpKSxcbiAgICBdLFxuICAgIHBsdWdpbnM6IFtcbiAgICAgIHJvbGx1cEpzb24oeyBwcmVmZXJDb25zdDogdHJ1ZSB9KSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogXCJcIixcbiAgICAgICAgcmVzb2x2ZUlkOiBmdW5jdGlvbiAoaW1wb3J0ZWUsIGltcG9ydGVyKSB7XG4gICAgICAgICAgaWYgKGltcG9ydGVlLmVuZHNXaXRoKFwiL3BhY2thZ2UuanNvblwiKSkge1xuICAgICAgICAgICAgY29uc3QgcCA9IHBhdGgucmVzb2x2ZShwYXRoLmRpcm5hbWUoaW1wb3J0ZXIpLCBpbXBvcnRlZSk7XG4gICAgICAgICAgICBpZiAocCA9PT0gcGF0aC5yZXNvbHZlKElOUFVUX0RJUiwgXCJwYWNrYWdlLmpzb25cIikpXG4gICAgICAgICAgICAgIHJldHVybiBwYXRoLnJlc29sdmUoT1VUUFVUX0RJUiwgXCJwYWNrYWdlLmpzb25cIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHR5cGVzY3JpcHQoeyB0c2NvbmZpZzogXCIuL3RzY29uZmlnLmpzb25cIiB9KSxcbiAgICAgIG5vZGVSZXNvbHZlKCksXG4gICAgICBjb21tb25qcygpLFxuICAgICAgTU9ERSA9PT0gXCJwcm9kdWN0aW9uXCIgPyB0ZXJzZXIoKSA6IG51bGwsXG4gICAgXSxcbiAgICBwcmVzZXJ2ZUVudHJ5U2lnbmF0dXJlczogZmFsc2UsXG4gICAgdHJlZXNoYWtlOiB7XG4gICAgICBwcm9wZXJ0eVJlYWRTaWRlRWZmZWN0czogZmFsc2UsXG4gICAgICBtb2R1bGVTaWRlRWZmZWN0czogZmFsc2UsXG4gICAgfSxcbiAgICBvbndhcm46ICgod2FybmluZywgd2FybikgPT4ge1xuICAgICAgLy8gSWdub3JlIGNpcmN1bGFyIGRlcGVuZGVuY3kgd2FybmluZ3NcbiAgICAgIGlmICh3YXJuaW5nLmNvZGUgIT09IFwiQ0lSQ1VMQVJfREVQRU5ERU5DWVwiKSB3YXJuKHdhcm5pbmcpO1xuICAgIH0pIGFzIFdhcm5pbmdIYW5kbGVyLFxuICB9KTtcblxuICBhd2FpdCBidW5kbGUud3JpdGUoe1xuICAgIG1hbnVhbENodW5rczogKGlkKSA9PiB7XG4gICAgICBpZiAoaWQuaW5jbHVkZXMoXCJub2RlX21vZHVsZXMvY29kZW1pcnJvclwiKSkgcmV0dXJuIFwiY29kZW1pcnJvclwiO1xuICAgICAgZWxzZSBpZiAoaWQuaW5jbHVkZXMoXCJub2RlX21vZHVsZXMveWFtbFwiKSkgcmV0dXJuIFwieWFtbFwiO1xuICAgICAgcmV0dXJuIFwiYXBwXCI7XG4gICAgfSxcbiAgICBwcmVmZXJDb25zdDogdHJ1ZSxcbiAgICBmb3JtYXQ6IFwiZXNcIixcbiAgICBzb3VyY2VtYXA6IHRydWUsXG4gICAgc291cmNlbWFwRXhjbHVkZVNvdXJjZXM6IHRydWUsXG4gICAgZGlyOiBvdXRwdXREaXIsXG4gIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUljb25zU3ByaXRlKCk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzeW1ib2xzID0gW107XG4gIGNvbnN0IGljb25zRGlyID0gcGF0aC5yZXNvbHZlKElOUFVUX0RJUiwgXCJ1aS9pY29uc1wiKTtcbiAgZm9yIChjb25zdCBmaWxlIG9mIGZzLnJlYWRkaXJTeW5jKGljb25zRGlyKSkge1xuICAgIGNvbnN0IGlkID0gcGF0aC5wYXJzZShmaWxlKS5uYW1lO1xuICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKGljb25zRGlyLCBmaWxlKTtcbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IG9wdGltaXplKGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCkudG9TdHJpbmcoKSwge1xuICAgICAgcGx1Z2luczogW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogXCJwcmVzZXQtZGVmYXVsdFwiLFxuICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgb3ZlcnJpZGVzOiB7XG4gICAgICAgICAgICAgIHJlbW92ZVZpZXdCb3g6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgICBzeW1ib2xzLnB1c2goZ2VuZXJhdGVTeW1ib2woaWQsIGRhdGEpKTtcbiAgfVxuICBmcy53cml0ZUZpbGVTeW5jKFxuICAgIHBhdGgucmVzb2x2ZShPVVRQVVRfRElSLCBcInB1YmxpYy9pY29ucy5zdmdcIiksXG4gICAgYDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiPiR7c3ltYm9scy5qb2luKFwiXCIpfTwvc3ZnPmBcbiAgKTtcbn1cblxuaW5pdCgpXG4gIC50aGVuKChleHRlcm5hbHMpID0+IHtcbiAgICBQcm9taXNlLmFsbChbXG4gICAgICBjb3B5U3RhdGljKCksXG4gICAgICBnZW5lcmF0ZUNzcygpLFxuICAgICAgZ2VuZXJhdGVJY29uc1Nwcml0ZSgpLFxuICAgICAgZ2VuZXJhdGVCYWNrZW5kSnMoZXh0ZXJuYWxzKSxcbiAgICAgIGdlbmVyYXRlRnJvbnRlbmRKcyhleHRlcm5hbHMpLFxuICAgIF0pXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIC8vIElnbm9yZVxuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIHByb2Nlc3Muc3RkZXJyLndyaXRlKGVyci5zdGFjayArIFwiXFxuXCIpO1xuICAgICAgfSk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgcHJvY2Vzcy5zdGRlcnIud3JpdGUoZXJyLnN0YWNrICsgXCJcXG5cIik7XG4gIH0pO1xuIl19